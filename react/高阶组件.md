# æ·±å…¥ React é«˜é˜¶ç»„ä»¶

> è§£å†³å…³æ³¨ç‚¹æ¨ªåˆ‡ï¼ŒæŠ½å–å‡ºç»„ä»¶çš„å…¬å…±éƒ¨åˆ†ï¼Œæ˜¯å¤§å‹åº”ç”¨çš„å¿…å¤‡å·¥ä½œã€‚

## 1. å…³æ³¨ç‚¹æ¨ªåˆ‡

ç›®çš„ï¼šï¼Ÿç»„ä»¶æŠ½è±¡ï¼Ÿ

å…³æ³¨ç‚¹æ˜¯æ˜¯ä»€ä¹ˆ â“

**å…³æ³¨ç‚¹**æŒ‡æŸä¸ªåŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ï¼‰ã€‚

**æ¨ªåˆ‡å…³æ³¨ç‚¹**æ˜¯æŒ‡é¢å‘å¯¹è±¡ä¸­æŸä¸ª**å…³æ³¨ç‚¹åœ¨å¤šä¸ªæ¨¡å—ä¸­ä½¿ç”¨**ï¼ˆå¦‚æ—¥å¿—æ¨¡å—ï¼‰ã€‚

## 2. å¦‚ä½•è§£å†³å…³æ³¨ç‚¹æ¨ªåˆ‡



## 3.mixin

### 3.1 ä»€ä¹ˆæ˜¯ mixin

### 3.2 å¦‚ä½•ä½¿ç”¨ mixin

### 3.3 mixin ä½¿ç”¨æŠ€å·§

### 3.4 mixin çš„åº”ç”¨

### 3.5 mixin æ³¨æ„äº‹é¡¹

## 4. **é«˜é˜¶ç»„ä»¶**

### 4.1 é«˜é˜¶ç»„ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ

<code style="color: #708090; background-color: #F5F5F5; font-size: 18px">é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰</code>æ˜¯ä¸€ç§åŸºäº React çš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„**è®¾è®¡æ¨¡å¼**ã€‚

å…·ä½“è€Œè¨€ï¼Œ<span style="color: #ff0000; font-size: 16px;">é«˜é˜¶ç»„ä»¶æ˜¯å‚æ•°ä¸ºç»„ä»¶ï¼Œè¿”å›å€¼ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°</span>ã€‚

å¯ä»¥çœ‹å‡ºï¼ŒHOC çš„**ä¸»è¦ä½œç”¨æ˜¯å¤ç”¨ç»„ä»¶**ã€‚

```js
const EnhancedComponent = higherOrderComponent(WrappedComponent);
```

#### 1.2.1 é«˜é˜¶ç»„ä»¶è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹é—®é¢˜



å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„æ¨¡å—ä¸­åšä»¥ä¸‹äº‹æƒ…ï¼š

- åœ¨æŒ‚è½½æ—¶ï¼Œå‘ DataSource æ·»åŠ ä¸€ä¸ªæ›´æ”¹ä¾¦å¬å™¨ï¼ˆç”¨äºè·å–æ•°æ®ï¼‰
- åœ¨ä¾¦å¬å™¨å†…éƒ¨ï¼Œå½“æ•°æ®æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨ setStateï¼ˆè®¾ç½®æ•°æ®ï¼‰
- åœ¨å¸è½½æ—¶ï¼Œåˆ é™¤ä¾¦å¬å™¨ï¼ˆåˆ é™¤ç›‘å¬å™¨ï¼‰

_CommentList å’Œ BlogPost ä¸¤ä¸ªç»„ä»¶éƒ½éœ€è¦è·å–è¯„è®ºæ•°æ®ï¼š_

```js
const CommentListWithSubscription = withSubscription(
  CommentList,
  (DataSource) => DataSource.getComments()
);

const BlogPostWithSubscription = withSubscription(
  BlogPost,
  (DataSource, props) => DataSource.getBlogPost(props.id)
);
```

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯**è¢«åŒ…è£…ç»„ä»¶**ã€‚

ç¬¬äºŒä¸ªå‚æ•°é€šè¿‡ **DataSource** å’Œå½“å‰çš„ **props** è¿”å›æˆ‘ä»¬**éœ€è¦çš„æ•°æ®**ã€‚

_é«˜ä»·ç»„ä»¶ç¤ºä¾‹ï¼š_

```js
// æ­¤å‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶(ä¼ å…¥ç»„ä»¶)...
function withSubscription(WrappedComponent, selectData) {
  // ...å¹¶è¿”å›å¦ä¸€ä¸ªç»„ä»¶ï¼ˆå¢å¼ºç»„ä»¶ï¼‰...
  return class extends React.Component {
    constructor(props) {
      super(props);
      this.handleChange = this.handleChange.bind(this);
      this.state = {
        data: selectData(DataSource, props),
      };
    }

    componentDidMount() {
      // ...è´Ÿè´£è®¢é˜…ç›¸å…³çš„æ“ä½œ...
      DataSource.addChangeListener(this.handleChange);
    }

    componentWillUnmount() {
      DataSource.removeChangeListener(this.handleChange);
    }

    handleChange() {
      this.setState({
        data: selectData(DataSource, this.props),
      });
    }

    render() {
      // ... å¹¶ä½¿ç”¨æ–°æ•°æ®æ¸²æŸ“è¢«åŒ…è£…çš„ç»„ä»¶!
      // è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜ä¼šä¼ é€’å…¶ä»–å±æ€§
      return <WrappedComponent data={this.state.data} {...this.props} />;
    }
  };
}
```

**HOC ç‰¹æ€§ï¼š**

- HOC æ¥æ”¶ä¸€ä¸ªç»„ä»¶(ä¼ å…¥ç»„ä»¶)ï¼Œä½¿ç”¨æ•°æ®å°†è¯¥ç»„ä»¶ç»„åˆæˆä¸€ä¸ªæ–°ç»„ä»¶ï¼Œå¹¶è¿”å›æ–°ç»„ä»¶ï¼ˆå¢å¼ºç»„ä»¶ï¼‰
- HOC ä¸ä¼šä¿®æ”¹ä¼ å…¥çš„ç»„ä»¶ï¼Œåªæ˜¯æ·»åŠ äº†æŸäº›å±æ€§
- HOC åº”è¯¥æ˜¯çº¯å‡½æ•°ï¼Œä¸èƒ½æœ‰å‰¯ä½œç”¨

**HOC é”™è¯¯ç¤ºä¾‹ï¼šâŒ**

_HOC ä¸­ä¿®æ”¹ç»„ä»¶åŸå‹ï¼š_

```js
function logProps(InputComponent) {
  InputComponent.prototype.componentDidUpdate = function (prevProps) {
    console.log("Current props: ", this.props);
    console.log("Previous props: ", prevProps);
  };
  // è¿”å›åŸå§‹çš„ input ç»„ä»¶ï¼Œæš—ç¤ºå®ƒå·²ç»è¢«ä¿®æ”¹ã€‚
  return InputComponent;
}

// æ¯æ¬¡è°ƒç”¨ logProps æ—¶ï¼Œç”Ÿå‘½å‘¨æœŸå‡½æ•°componentDidUpdateéƒ½ä¼šæ‰§è¡Œï¼Œå¢å¼ºç»„ä»¶éƒ½ä¼šæœ‰ log è¾“å‡ºã€‚
const EnhancedComponent = logProps(InputComponent);
```







## 2. é«˜é˜¶ç»„ä»¶æœ‰ä½•ç”¨ï¼Ÿ

å®šä¹‰ä¸­å·²ç»è¯´äº†ï¼Œ**é«˜é˜¶ç»„ä»¶æ˜¯ä¸ºäº†è§£å†³ React ç»„ä»¶çš„ç»„åˆé—®é¢˜**ã€‚

é«˜é˜¶ç»„ä»¶ä¸»è¦<span style="color: #ff0000; font-size: 16px;">è§£å†³å…³æ³¨ç‚¹æ¨ªåˆ‡çš„é—®é¢˜</span>ã€‚

ä»€ä¹ˆæ˜¯**å…³æ³¨ç‚¹æ¨ªåˆ‡**â“

é€šä¿—çš„è¯´å°±æ˜¯ï¼ŒæŸäº›**ä»»åŠ¡**ï¼ˆå…³æ³¨ç‚¹ï¼‰è¢«**å¤šä¸ªæ¨¡å—é‡å¤ä½¿ç”¨**ï¼ˆæ¨ªåˆ‡ï¼‰ã€‚

å¸¸è§çš„å…³æ³¨ç‚¹æ¨ªåˆ‡æœ‰ï¼š

- æ—¥å¿—åŠŸèƒ½ï¼šå¤šä¸ªæ¨¡å—å¯èƒ½éƒ½ä¼šç”¨åˆ°
- è·å–ç”¨æˆ·ä¿¡æ¯

ä¸€å¥è¯ç»ˆç»“å°±æ˜¯ï¼š**HOC å¯ä»¥å¸®åŠ©æˆ‘ä»¬æŠ½è±¡å‡ºç»„ä»¶çš„å…¬å…±éƒ¨åˆ†**ã€‚

## 3. é«˜é˜¶ç»„ä»¶å’Œæ™®é€šç»„ä»¶çš„åŒºåˆ«

**é«˜é˜¶ç»„ä»¶å’Œæ™®é€šç»„ä»¶çš„åŒºåˆ«æ˜¯**ï¼š

**æ™®é€šç»„ä»¶**æ˜¯<span style="color: #ff0000; font-size: 16px;">å°† props/state è½¬æ¢ä¸º UI</span>ï¼Œè€Œ**é«˜é˜¶ç»„ä»¶**æ˜¯<span style="color: #ff0000; font-size: 16px;">å°†ç»„ä»¶è½¬æ¢ä¸ºå¦ä¸€ä¸ªç»„ä»¶</span>ã€‚

ä¸Šé¢è¿™å¥è¯æ¥è‡ª[React-é«˜é˜¶ç»„ä»¶å®˜æ–¹æ–‡æ¡£](https://zh-hans.reactjs.org/docs/higher-order-components.html#convention-wrap-the-display-name-for-easy-debugging)ï¼Œå®ƒå…·æœ‰çº²é¢†æ„ä¹‰ã€‚

å¦‚æœæˆ‘ä»¬éœ€è¦å¤„ç†ä¸œè¥¿å’Œ UI ç›¸å…³ï¼Œé‚£ä¹ˆï¼Œä»–å°±æ˜¯**ç»„ä»¶çš„ç»„åˆé—®é¢˜**ã€‚

å¦‚æœæˆ‘ä»¬å¤„ç†çš„ä¸œè¥¿æ˜¯å¤šä¸ªç»„ä»¶å…±åŒæ‰€æœ‰çš„ï¼Œæƒ³è¦æŠŠ**å…±æœ‰çš„å¤„ç†åŠæ³•æå–å‡ºæ¥**ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ HOCã€‚

## 4. å¦‚ä½•å®ç°é«˜é˜¶ç»„ä»¶

> é«˜é˜¶ç»„ä»¶å°±æ˜¯è¦æ“ä½œ WrappedComponentï¼Œå¾—åˆ°ä¸€ä¸ªå¢å¼ºçš„æ–°ç»„ä»¶ã€‚

å¦‚ä½•æ“ä½œå‘¢ â“

- **å±æ€§ä»£ç†ï¼ˆprops proxyï¼‰**ï¼šé«˜é˜¶ç»„ä»¶<span style="color: #ff0000; font-size: 16px;">é€šè¿‡è¢«åŒ…è£¹çš„ React ç»„ä»¶æ¥æ“ä½œ props</span>
- **åå‘ç»§æ‰¿(inheritance inversion)**ï¼šé«˜é˜¶ç»„ä»¶<span style="color: #ff0000; font-size: 16px;">ç»§æ‰¿äºè¢«åŒ…è£¹çš„ç»„ä»¶</span>

### 3.1 å±æ€§ä»£ç†

**Props Proxy çš„ç®€å•å®ç°**ï¼š

```js
function HOC(WrappedComponent) {
  return class EnhancedComponent extends React.Component {
    render() {
      return <WrappedComponent {...this.props} />;
    }
  };
}
```

éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒEnhancedComponent åœ¨è¿™é‡Œæ˜¯<code style="color: #708090; background-color: #F5F5F5; font-size: 18px">å®¹å™¨ç»„ä»¶</code>ï¼Œå®ƒåŒ…è£¹ç€**åŒ…è£¹ç»„ä»¶(WrappedComponent)**ï¼ŒğŸŒŸ å°±æ˜¯å®ƒ**æ¥å¤„ç†å…·ä½“å¢å¼ºé€»è¾‘**ã€‚

HOC åšäº†ä»€ä¹ˆï¼Ÿ

**é€šè¿‡ç»™ WrappedComponent ä¼ é€’ this.props å¾—åˆ°ä¸€ä¸ªæ–°çš„ç»„ä»¶**ã€‚

<code style="color: #708090; background-color: #F5F5F5; font-size: 18px">this.props</code>æ˜¯**WrappedComponent**æœ¬èº«å…·æœ‰çš„å±æ€§ï¼Œä½¿ç”¨**EnhancedComponent**æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚

_ç¤ºä¾‹ 1ï¼š_

```js
import { Component } from "react";
// å®šä¹‰è¢«åŒ…è£¹ç»„ä»¶
const Mouse = (props) => {
  return (
    <span className="mouse" role={props.role}>
      ğŸ­
    </span>
  );
};

// å®šä¹‰ HOC
const withDrag = (Wrapped) => {
  class WithDrag extends Component {
    render = () => {
      // this.propsæ˜¯è¦é€ä¼ ç»™ Wrapped çš„å±æ€§
      return <Wrapped {...this.props} />;
    };
  }
  return WithDrag;
};

// ç”Ÿæˆå¢å¼ºç»„ä»¶ MouseDraggable
const MouseDraggable = withDrag(Mouse);

// ä½¿ç”¨å¢å¼ºç»„ä»¶
ReactDOM.render(
  <MouseDraggable role="mouse" />,
  document.getElementById("root")
);
```

è¿™æ˜¯ä¸ªåŸºç¡€ç¤ºä¾‹ï¼Œå¹¶æ²¡æœ‰å¢å¼º**Mouse ç»„ä»¶**çš„ä»»ä½•åŠŸèƒ½ã€‚

æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹**å±æ€§ä»£ç†**å¯ä»¥åšä»€ä¹ˆï¼š

- æ“ä½œ props
- é€šè¿‡ Refs è®¿é—®åˆ°ç»„ä»¶å®ä¾‹
- æå– state
- ç”¨å…¶ä»–å…ƒç´ åŒ…è£¹ WrappedComponent

#### 3.1.1 æ“ä½œ props

**å¯ä»¥è¯»å–ã€æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ä¼ ç»™ WrappedComponent çš„ props**ã€‚

_æ”¹è¿›ä¾‹ 1 ä¸­çš„ HOC:_

```js
const withDrag = (Wrapped) => {
  class WithDrag extends Component {
    // å¢åŠ æ–°çš„ props
    const newProps = {
      title: "draggable"
    }
    render = () => {
      return <Wrapped {...this.props} {...newProps} />;
    };
  }
  return WithDrag;
};
```

#### 3.1.2 é€šè¿‡ Refs è®¿é—®åˆ°ç»„ä»¶å®ä¾‹

<code style="color: #708090; background-color: #F5F5F5; font-size: 18px">ref</code>åƒ<code style="color: #708090; background-color: #F5F5F5; font-size: 18px">key</code>ä¸€æ ·ï¼Œå®ƒ**ä¸æ˜¯ prop å±æ€§**ï¼Œä¼šè¢« React è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚

å¦‚æœå¯¹ HOC æ·»åŠ  refï¼Œè¯¥ <span style="color: #ff0000; font-size: 16px;">ref å°†å¼•ç”¨æœ€å¤–å±‚çš„å®¹å™¨ç»„ä»¶ï¼Œè€Œä¸æ˜¯è¢«åŒ…è£¹çš„ç»„ä»¶</span>ã€‚

```js
...
const withDrag = (Wrapped) => {
  class WithDrag extends Component {
    render = () => {
      return <Wrapped {...this.props} />;
    };
  }
  return WithDrag;
};

const MouseDraggable = withDrag(Mouse);
// åˆ›å»ºref
const ref = React.createRef();

ReactDOM.render(
  <MouseDraggable role="mouse" ref={ref} />,
  document.getElementById("root")
);
```

è¿™é‡Œçš„ ref æŒ‡å‘ **HOC çš„å®¹å™¨ç»„ä»¶** -- WithDragã€‚

<code style="color: #708090; background-color: #F5F5F5; font-size: 18px">React.forwardRef</code> å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒèƒ½å¸®æˆ‘ä»¬è½¬å‘ ref åˆ°å¢å¼ºåçš„ç»„ä»¶ã€‚

```js
import { Component } from "react";
const Mouse = (props) => {
  return (
    <span className="mouse" role={props.role}>
      ğŸ­
    </span>
  );
};

const withDrag = (Wrapped) => {
  class WithDrag extends Component {
    render = () => {
      return <Wrapped {...this.props} />;
    };
  }
  return WithDrag;
};

const MouseDraggable = withDrag(Mouse);
const ref = React.createRef();

ReactDOM.render(
  <MouseDraggable role="mouse" ref={ref} />,
  document.getElementById("root")
);
```

è¿™é‡Œçš„ ref æŒ‡å‘ **MouseDraggable**ã€‚

### 3.2 åå‘ç»§æ‰¿

## 4. çº¦å®š

æ—¢ç„¶é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ç§**è®¾è®¡æ¨¡å¼**ï¼Œæˆ‘ä»¬åº”è¯¥å‡†å®ˆå®ƒçš„è®¾è®¡çº¦å®šã€‚

## 5. æ³¨æ„äº‹é¡¹

## å‚è€ƒ

**Blog:**

æµ…æ˜¾æ˜“æ‡‚ï¼ŒåŠ¨ç”»è¾…åŠ© -- [REACT HIGHER ORDER COMPONENTS IN 3 MINUTES](https://jhey.dev/writing/react-higher-order-components-in-3-minutes/)

æ·±å…¥è®²è§£ï¼Œå€¼å¾—ç ”ç©¶ -- [React Higher Order Components in depth](https://medium.com/@franleplant/react-higher-order-components-in-depth-cf9032ee6c3e#.g1lnzrw5d)

**æ–‡æ¡£:**

[é«˜é˜¶ç»„ä»¶](https://zh-hans.reactjs.org/docs/higher-order-components.html)

[æš‚æ—¶çœ‹çœ‹ï¼Œç¿»è¯‘](https://zhuanlan.zhihu.com/p/24776678)



## å‚è€ƒ

å®˜æ–¹æ–‡æ¡£ï¼Œæ€»ç»“å…¨é¢ï¼Œä½†ä¸å¤ªå®¹æ˜“ç†è§£ -- [é«˜é˜¶ç»„ä»¶](https://zh-hans.reactjs.org/docs/higher-order-components.html)

ç”ŸåŠ¨å½¢è±¡ -- [REACT HIGHER ORDER COMPONENTS IN 3 MINUTES](https://jhey.dev/writing/react-higher-order-components-in-3-minutes/)
