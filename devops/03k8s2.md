# K8sæŒ‡å—ï¼Œå­¦è€Œæ—¶ä¹ ä¹‹

## 1. èµ„æºå“ªé‡Œæ‰¾ï¼Ÿ

### 1.1 [k8så®˜æ–¹æ–‡æ¡£é¦–é¡µ](https://kubernetes.io/zh-cn/docs/home/)

å¸¸ç”¨çš„å®˜æ–¹æ–‡æ¡£é›†åˆï¼š

- [**æ¦‚è¿°**--è®¤è¯†k8s](https://kubernetes.io/zh-cn/docs/concepts/overview/)

  - k8sç»„ä»¶ï¼šAPI serverã€Nodeã€Control managerã€kubeletã€kube-proxyã€Schedulerã€etcdç­‰
    - `kube-proxy` è´Ÿè´£ä¸º Service å®ç°äº†ä¸€ç§ VIPï¼ˆè™šæ‹Ÿ IPï¼‰çš„å½¢å¼
  - k8sAPI
  - k8så¯¹è±¡ï¼š**å¯¹è±¡** æ˜¯æŒä¹…åŒ–çš„å®ä½“ã€‚ Kubernetes ä½¿ç”¨è¿™äº›å®ä½“å»è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ã€‚é€šå¸¸ç”¨ .yamlæ–‡ä»¶æ¥æè¿°å¯¹è±¡ã€‚

- [**æ¶æ„**--k8så¦‚ä½•è¿è¡Œ](https://kubernetes.io/zh-cn/docs/concepts/architecture/)

  - èŠ‚ç‚¹
  - èŠ‚ç‚¹å’Œæ§åˆ¶é¢ï¼ˆAPI æœåŠ¡å™¨ï¼‰çš„é€šä¿¡--kubeletç­‰çŸ¥è¯†ç‚¹
  - æ§åˆ¶å™¨ï¼šé€šè¿‡ç›‘æ§[é›†ç¾¤](https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-cluster) çš„å…¬å…±çŠ¶æ€ï¼Œå¹¶è‡´åŠ›äºå°†*å½“å‰çŠ¶æ€*è½¬å˜ä¸º*æœŸæœ›çš„çŠ¶æ€*ã€‚
  - CRIï¼ˆå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼‰ï¼š [kubelet](https://kubernetes.io/docs/reference/generated/kubelet) èƒ½å¯åŠ¨ [Pod](https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/) åŠå…¶å®¹å™¨ï¼ŒCRIå°±æ˜¯ kubelet å’Œå®¹å™¨è¿è¡Œæ—¶ä¹‹é—´é€šä¿¡çš„ä¸»è¦åè®®ã€‚

- [**å®¹å™¨**--ç”¨æ¥è¿è¡Œæˆ‘ä»¬çš„ç¨‹åº](https://kubernetes.io/zh-cn/docs/concepts/containers/)

  - å®¹å™¨ï¼šå®¹å™¨å°†**åº”ç”¨ç¨‹åº**ä»åº•å±‚çš„ä¸»æœºè®¾æ–½ä¸­è§£è€¦ã€‚
  - å®¹å™¨é•œåƒï¼ˆImageï¼‰ï¼šå°è£…äº†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰è½¯ä»¶ä¾èµ–çš„äºŒè¿›åˆ¶æ•°æ®ã€‚å®ƒæ˜¯ä¸ªè½¯ä»¶åŒ…ï¼Œå¯¹æ‰€å¤„çš„è¿è¡Œæ—¶ç¯å¢ƒå…·æœ‰è‰¯å®šï¼ˆWell Definedï¼‰çš„å‡å®šã€‚
  - [å®¹å™¨ç¯å¢ƒ](https://kubernetes.io/zh-cn/docs/concepts/containers/#container-runtimes)ï¼šç»™å®¹å™¨æä¾›äº†1. æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª[é•œåƒ](https://kubernetes.io/zh-cn/docs/concepts/containers/images/) å’Œä¸€ä¸ªæˆ–å¤šä¸ªçš„[å·](https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/)  2.å®¹å™¨è‡ªèº«çš„ä¿¡æ¯ 3.é›†ç¾¤ä¸­å…¶ä»–å¯¹è±¡çš„ä¿¡æ¯
  - å®¹å™¨ç”Ÿå‘½å‘¨æœŸ

- **å·¥ä½œè´Ÿè½½**--å·¥ä½œè´Ÿè½½æ˜¯åœ¨ Kubernetes ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åº

  - Podï¼š`Pod` ä»£è¡¨çš„æ˜¯é›†ç¾¤ä¸Šå¤„äºè¿è¡ŒçŠ¶æ€çš„ä¸€ç»„ [å®¹å™¨](https://kubernetes.io/zh-cn/docs/concepts/overview/what-is-kubernetes/#why-containers) çš„é›†åˆã€‚**Pod** æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚
  - å·¥ä½œè´Ÿè½½èµ„æº--**Deployents**ï¼šä¸€ä¸ª Deployment ä¸º [Pod](https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/) å’Œ [ReplicaSet](https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicaset/) æä¾›å£°æ˜å¼çš„æ›´æ–°èƒ½åŠ›ã€‚Deployment [æ§åˆ¶å™¨ï¼ˆControllerï¼‰](https://kubernetes.io/zh-cn/docs/concepts/architecture/controller/)ä¼šç®¡ç†ä½ æè¿°çš„æœŸæœ›ã€‚é€‚åˆç”¨æ¥ç®¡ç†ä½ çš„é›†ç¾¤ä¸Šçš„æ— çŠ¶æ€åº”ç”¨ï¼Œ`Deployment` ä¸­çš„æ‰€æœ‰ `Pod` éƒ½æ˜¯ç›¸äº’ç­‰ä»·çš„ï¼Œå¹¶ä¸”åœ¨éœ€è¦çš„æ—¶å€™è¢«æ›¿æ¢ã€‚
  - å·¥ä½œè´Ÿè½½èµ„æº--**ReplicaSet**: ç”¨æ¥ä¿è¯ç»™å®šæ•°é‡çš„ã€å®Œå…¨ç›¸åŒçš„ Pod çš„å¯ç”¨æ€§ã€‚
  - å·¥ä½œè´Ÿè½½èµ„æº--**StatefulSet**: ç”¨æ¥ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„å·¥ä½œè´Ÿè½½ï¼Œå¦‚ï¼šå¤„ç†æ–‡ä»¶ä¸Šä¼ çš„Blogåº”ç”¨ã€‚`StatefulSet` ä¸­å„ä¸ª `Pod` å†…è¿è¡Œçš„ä»£ç å¯ä»¥å°†æ•°æ®å¤åˆ¶åˆ°åŒä¸€ `StatefulSet` ä¸­çš„å…¶å®ƒ `Pod` ä¸­ä»¥æé«˜æ•´ä½“çš„æœåŠ¡å¯é æ€§ã€‚
  - å·¥ä½œè´Ÿè½½èµ„æº--**DaemonSet**:  DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…æŸäº›ï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬
  - å·¥ä½œè´Ÿè½½èµ„æº--**Job**: Job ä¼šåˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª Podï¼Œå¹¶å°†ç»§ç»­é‡è¯• Pod çš„æ‰§è¡Œï¼Œç›´åˆ°æŒ‡å®šæ•°é‡çš„ Pod æˆåŠŸç»ˆæ­¢

- **æœåŠ¡ã€è´Ÿè½½å‡è¡¡å’Œè”ç½‘**

  - æœåŠ¡ï¼ˆServiceï¼‰-- ä¸€ç»„Podå’Œå‰¯æœ¬å¯èƒ½ä¼šè¢«é”€æ¯å’Œé‡å»ºï¼ŒService å®šä¹‰çš„æŠ½è±¡èƒ½å¤Ÿè§£è€¦Podä¹‹é—´é€šè¿‡IPæ¥é€šä¿¡çš„å…³ç³»ã€‚
  - Ingress -- å…¬å¼€ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…[æœåŠ¡](https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/)çš„ HTTP å’Œ HTTPS è·¯ç”±ã€‚

- **å­˜å‚¨**

  - **å·ï¼ˆVolumeï¼‰**ï¼šContainer ä¸­çš„æ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ˜¯ä¸´æ—¶å­˜æ”¾çš„ï¼Œå®¹å™¨å´©æºƒæˆ–kubelet ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œè¿™äº›ä¸´æ—¶æ–‡ä»¶ä¼šä¸¢å¤±ã€‚

    > 1. å·çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­å¯èƒ½å­˜æœ‰æ•°æ®ï¼ŒPod ä¸­çš„å®¹å™¨å¯ä»¥è®¿é—®è¯¥ç›®å½•ä¸­çš„æ•°æ®ã€‚
    >
    > 2. ç‰¹å®šçš„å·ç±»å‹å°†å†³å®šè¯¥ç›®å½•å¦‚ä½•å½¢æˆçš„ã€ä½¿ç”¨ä½•ç§ä»‹è´¨ä¿å­˜æ•°æ®ä»¥åŠç›®å½•ä¸­å­˜æ”¾çš„å†…å®¹ã€‚
    >
    > 3. ä½¿ç”¨å·æ—¶, åœ¨ `.spec.volumes` å­—æ®µä¸­*è®¾ç½®ä¸º Pod æä¾›çš„å·*ï¼Œå¹¶åœ¨ `.spec.containers[*].volumeMounts` å­—æ®µä¸­å£°æ˜*å·åœ¨å®¹å™¨ä¸­çš„æŒ‚è½½ä½ç½®*ã€‚
    > 4. å·æœ‰å¾ˆå¤šç§ï¼Œ[`configMap`](https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/) å·æä¾›äº†å‘ Pod æ³¨å…¥é…ç½®æ•°æ®çš„æ–¹æ³•ï¼›`nfs` å·èƒ½å°† NFS (ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ) æŒ‚è½½åˆ°ä½ çš„ Pod ä¸­ï¼›`persistentVolumeClaim` å·ç”¨æ¥å°†[æŒä¹…å·](https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/)ï¼ˆPersistentVolumeï¼‰æŒ‚è½½åˆ° Pod ä¸­ï¼›`secret` å·ç”¨æ¥ç»™ Pod ä¼ é€’æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€‚

  - **æŒä¹…å·ï¼ˆPersistentVolumeï¼ŒPVï¼‰** æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œå¯ä»¥ç”±ç®¡ç†å‘˜äº‹å…ˆåˆ¶å¤‡ï¼Œ æˆ–è€…ä½¿ç”¨[å­˜å‚¨ç±»ï¼ˆStorage Classï¼‰](https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/)æ¥åŠ¨æ€åˆ¶å¤‡ã€‚

  - **æŒä¹…å·ç”³é¢†ï¼ˆPersistentVolumeClaimï¼ŒPVCï¼‰** è¡¨è¾¾çš„æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„è¯·æ±‚ã€‚

    > PVC ç”³é¢†ä¸ PV å·ä¹‹é—´çš„ç»‘å®šæ˜¯ä¸€ç§ä¸€å¯¹ä¸€çš„æ˜ å°„ã€‚
    >
    > å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„ PV å·ï¼ŒPVC ç”³é¢†ä¼šæ— é™æœŸåœ°å¤„äºæœªç»‘å®šçŠ¶æ€ï¼ŒçŸ¥é“æ‰¾åˆ°åŒ¹é…çš„PVå·ã€‚

  - **å­˜å‚¨ç±»ï¼ˆStorageClassï¼‰**ï¼š ä¸ºç®¡ç†å‘˜æä¾›äº†æè¿°å­˜å‚¨ "ç±»" çš„æ–¹æ³•ã€‚

  - **åŠ¨æ€å·åˆ¶å¤‡**ï¼šæŒ‰éœ€åˆ›å»ºå­˜å‚¨å·ã€‚

    > åŠ¨æ€å·åˆ¶å¤‡çš„å®ç°åŸºäº `storage.k8s.io` API ç»„ä¸­çš„ `StorageClass` API å¯¹è±¡ã€‚
    >
    > `StorageClass` å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡æŒ‡å®šä¸€ä¸ª**å·æ’ä»¶**ï¼ˆåˆå **provisioner**ï¼‰.
    >
    > åŠ¨æ€åˆ¶å¤‡è¿‡ç¨‹ï¼š
    >
    > 1. åˆ›å»ºPVCï¼Œå¹¶å®šä¹‰å…¶â€œå­˜å‚¨ç±»â€åç§°ä¸º â€œfastâ€(æ„ä¸ºä¸€ä¸ªå¿«é€Ÿç±»å‹çš„å­˜å‚¨å·)
    >
    >    ```yaml
    >    apiVersion: v1
    >    kind: PersistentVolumeClaim # å®šä¹‰èµ„æºçš„ç±»ä¸ºå­˜å‚¨å·
    >    metadata:
    >      name: claim1
    >    spec:
    >      accessModes:
    >        - ReadWriteOnce
    >      storageClassName: fast # å®šä¹‰â€œå­˜å‚¨ç±»â€çš„åç§°
    >      resources:
    >        requests:
    >          storage: 30Gi # å®šä¹‰å·çš„èµ„æºå¤§å°
    >    ```
    >
    >    ğŸŒŸğŸŒŸè¯¥å£°æ˜ä¼šè‡ªåŠ¨åˆ¶å¤‡ä¸€å—ç±»ä¼¼ SSD çš„æ°¸ä¹…ç£ç›˜ã€‚ åœ¨åˆ é™¤è¯¥å£°æ˜åï¼Œè¿™ä¸ªå·ä¹Ÿä¼šè¢«é”€æ¯ã€‚
    >
    > 2. ä»¥ä¸‹æ¸…å•åˆ›å»ºäº†ä¸€ä¸ª "fast" å­˜å‚¨ç±»ï¼Œå®ƒæä¾›ç±»ä¼¼ SSD çš„æ°¸ä¹…ç£ç›˜ã€‚
    >
    >    ```yaml
    >    apiVersion: storage.k8s.io/v1
    >    kind: StorageClass
    >    metadata:
    >      name: fast # æŒ‡å®šå­˜å‚¨ç±»ä½¿ç”¨çš„PVC
    >    provisioner: kubernetes.io/gce-pd
    >    parameters:
    >      type: pd-ssd
    >    ```

- **é…ç½®**
  - [æœ€ä½³é…ç½®å®è·µ--å‘Šæˆ‘æˆ‘ä»¬å¦‚ä½•å†™ yaml](https://kubernetes.io/zh-cn/docs/concepts/configuration/overview/)
  - **ConfigMap**: ä¸€ç§ API å¯¹è±¡ï¼Œ [Pods](https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/) å¯ä»¥å°†å…¶ç”¨ä½œç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°æˆ–è€…å­˜å‚¨å·ä¸­çš„é…ç½®æ–‡ä»¶ã€‚ConfigMap å°†ä½ çš„ç¯å¢ƒé…ç½®ä¿¡æ¯å’Œ [å®¹å™¨é•œåƒ](https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-image) è§£è€¦ã€‚
  - **Secret**ï¼š ä¸€ç§åŒ…å«å°‘é‡æ•æ„Ÿä¿¡æ¯ä¾‹å¦‚å¯†ç ã€ä»¤ç‰Œæˆ–å¯†é’¥çš„å¯¹è±¡ã€‚
  - [ä¸º Pod å’Œå®¹å™¨ç®¡ç†èµ„æº](https://kubernetes.io/zh-cn/docs/concepts/configuration/manage-resources-containers/)
  - 

## 2. kubectl å‘½ä»¤å‚è€ƒ

> ç»ˆäºä¸ç”¨æ•´å¤©ä¹±æ‰¾å‘½ä»¤å’Œå‚æ•°äº†ã€‚

[å‘½ä»¤è¡Œå¤‡å¿˜å½•--å¸¸è§çš„éƒ½åœ¨è¿™](https://kubernetes.io/zh-cn/docs/reference/kubectl/cheatsheet/)

[æ‰€æœ‰å‚è€ƒåœ¨è¿™é‡ŒğŸŒŸ](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands)

[dockerä¸kubectl](https://kubernetes.io/zh-cn/docs/reference/kubectl/docker-cli-to-kubectl/)

## 3. k8så­¦ä¹ å¹³å°

[Kllercoda--k8sçº¿ä¸Šå­¦ä¹ å¹³å°](https://killercoda.com/playgrounds/scenario/kubernetes)