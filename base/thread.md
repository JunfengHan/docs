# 进程与线程

## 1. 认识进程与线程

CPU 类比为一个工厂，工厂里的车间在不停的运作，假如电力有限，只能同时运行一个车间，一个车间分配了空间、资源和工人，工人负责做具体的事情。

这时，工厂里的车间就相当于 CUP 的进程，同一时间只能有一个进程运行，工厂里的工人像进程中的线程，线程共享进程里的内存和资源，同时线程做具体的事情。

如： Chrome 浏览器采用**多进程架构**，打开一个 tab 就是启动一个进程，进程之间互不干扰，能做的事情更多，同时也比较安全。

浏览器通过浏览器内核显示页面信息，浏览器获取页面内容（HTML）、整理信息（CSS）、计算和组合最终输出可视化的页面，浏览器内核也叫**浏览器引擎**，Chrome 浏览器的引擎是 V8。

Chrome 每个 tab 都会单独启动一个进程，因此，每个网页都有其**独立的渲染引擎实例**。

**浏览器内核是多线程**，内核控制各线程相互配合以保持同步，浏览器通常有以下常驻线程组成：

- GUI 渲染线程 -> 负责渲染页面的重绘（Repaint）与回流（reflow）
- JavaScript 引擎线程 -> 使用 V8 引擎处理 JavaScript 脚本程序
- 定时触发线程 -> 用于浏览器定时计数，因为 JavaScript 引擎是单线程，会阻塞影响计时
- 事件触发线程 -> 事件触发（如 setTimeout、回调、Ajax 请求等）时往事件队列末尾添加，等待 JS 引擎处理
- 异步 http 请求线程 -> XMLHttpRequest 在连接后通过浏览器打开一个线程请求，检测到状态变更时如果有回调，异步线程就将产生状态变更事件放到 JavaScript 引擎处理队列末尾等待处理

**注意**⚠️：

- 1. JavaScript 引擎是单线程的，但是浏览器内核是多线程的
- 2. JavaScript 引擎和 GUI 渲染引擎是互斥的，因为两者不能同时操作 Dom, 因此，JavaScript 会阻塞页面加载

Java、PhP、.Net 这种一个进程中可以有多个线程的应用程序，在执行代码过程中，会开辟多个线程去分别执行那些线程当中会发生阻塞的代码。
多线程也是存在的问题：

1. 创建线程耗费资源
2. 线程数量有限
3. 线程之间共享某些数据、同步某个状态都很麻烦
4. CPU 在不同线程之间转换非常耗时

## 参考
